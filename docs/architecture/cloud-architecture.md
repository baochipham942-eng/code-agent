# äº‘ç«¯ä¸æœ¬åœ°ååŒæ¶æ„

> Gen 5-8 æ¼”è¿›çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½

## æ¶æ„æ€»è§ˆ

äº‘ç«¯ä¸æœ¬åœ°ååŒå®ç°ï¼š
- **æœ¬åœ°**ï¼šè´Ÿè´£"æ‰‹è„š"ï¼ˆæ–‡ä»¶æ“ä½œã€ç»ˆç«¯æ‰§è¡Œã€UI äº¤äº’ï¼‰
- **äº‘ç«¯**ï¼šè´Ÿè´£"å¤§è„‘"ï¼ˆå¤æ‚æ¨ç†ã€å¤šä»£ç†è°ƒåº¦ã€è·¨è®¾å¤‡è®°å¿†ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Cloud-Local Hybrid Architecture                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     Local Client (Electron App)                          â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚   â”‚  â”‚  Local Agent   â”‚ â”‚  Task Router   â”‚ â”‚  Sync Engine   â”‚               â”‚   â”‚
â”‚   â”‚  â”‚    Loop        â”‚ â”‚                â”‚ â”‚                â”‚               â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚   â”‚          â”‚                  â”‚                  â”‚                         â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚   â”‚  â”‚                   Local Executor                      â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â”‚  File   â”‚ â”‚  Shell  â”‚ â”‚   Git   â”‚ â”‚Computer â”‚    â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â”‚  Ops    â”‚ â”‚  Exec   â”‚ â”‚   Ops   â”‚ â”‚  Use    â”‚    â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚               â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                             â”‚
â”‚                          WebSocket â”‚ + REST API                                  â”‚
â”‚                                    â”‚                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        Supabase Cloud Platform                           â”‚   â”‚
â”‚   â”‚                                                                          â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚                     Edge Functions Layer                         â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚   Task     â”‚ â”‚  Agent     â”‚ â”‚  Workflow  â”‚ â”‚  Strategy  â”‚   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚  Router    â”‚ â”‚ Scheduler  â”‚ â”‚  Engine    â”‚ â”‚  Optimizer â”‚   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â”‚                                                                          â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚                     AI Services Layer                            â”‚    â”‚   â”‚
â”‚   â”‚  â”‚              Claude Agent SDK (Anthropic)                        â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚ Planner â”‚ â”‚  Coder  â”‚ â”‚Reviewer â”‚ â”‚Researcherâ”‚               â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚  Agent  â”‚ â”‚  Agent  â”‚ â”‚  Agent  â”‚ â”‚  Agent  â”‚               â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä»»åŠ¡åˆ†ç±»ä¸è·¯ç”±ç­–ç•¥

### ä»»åŠ¡åˆ†ç±»çŸ©é˜µ

| ä»»åŠ¡ç±»å‹ | æ‰§è¡Œä½ç½® | åŸå›  | ç¤ºä¾‹ |
|----------|----------|------|------|
| **æ–‡ä»¶ç³»ç»Ÿæ“ä½œ** | ğŸ  æœ¬åœ° | éœ€è¦æœ¬åœ°æ–‡ä»¶è®¿é—®æƒé™ | read_file, write_file, edit_file |
| **ç»ˆç«¯å‘½ä»¤æ‰§è¡Œ** | ğŸ  æœ¬åœ° | éœ€è¦æœ¬åœ°ç¯å¢ƒå’Œå·¥å…·é“¾ | bash, npm, git |
| **Computer Use** | ğŸ  æœ¬åœ° | éœ€è¦æœ¬åœ°å±å¹•å’Œè¾“å…¥è®¾å¤‡ | screenshot, click, type |
| **æ•æ„Ÿä»£ç å¤„ç†** | ğŸ  æœ¬åœ° | éšç§å’Œå®‰å…¨è€ƒè™‘ | å«å¯†é’¥/å‡­è¯çš„ä»£ç  |
| **å®æ—¶ UI äº¤äº’** | ğŸ  æœ¬åœ° | éœ€è¦å³æ—¶å“åº” | ask_user_question |
| **ä»£ç å®¡æŸ¥åˆ†æ** | â˜ï¸ äº‘ç«¯ | çº¯æ¨ç†ä»»åŠ¡ï¼Œæ— æœ¬åœ°ä¾èµ– | review_code |
| **æ–‡æ¡£ç”Ÿæˆ** | â˜ï¸ äº‘ç«¯ | å¯ç¦»çº¿å®Œæˆï¼Œç»“æœåŒæ­¥ | generate_docs |
| **å¤šæ–‡ä»¶é‡æ„è§„åˆ’** | â˜ï¸ äº‘ç«¯ | å¤æ‚æ¨ç†ï¼Œäº‘ç«¯ç®—åŠ›æ›´å¼º | plan_refactor |
| **è·¨é¡¹ç›®çŸ¥è¯†æ£€ç´¢** | â˜ï¸ äº‘ç«¯ | äº‘ç«¯å‘é‡åº“ç»Ÿä¸€ç®¡ç† | semantic_search |
| **å¤šä»£ç†ååŒ** | â˜ï¸ äº‘ç«¯ | äº‘ç«¯è°ƒåº¦å¤šä¸ª Agent æ›´é«˜æ•ˆ | multi_agent_task |
| **å¤§å‹é‡æ„æ‰§è¡Œ** | ğŸ”„ æ··åˆ | äº‘ç«¯è§„åˆ’ + æœ¬åœ°æ‰§è¡Œ | refactor_module |

### ä»»åŠ¡è·¯ç”±å™¨

```typescript
// src/main/cloud/TaskRouter.ts

export type TaskTarget = 'local' | 'cloud' | 'hybrid';

export class TaskRouter {
  private rules: RoutingRule[] = [
    // å¿…é¡»æœ¬åœ°æ‰§è¡Œ
    {
      pattern: ['bash', 'read_file', 'write_file', 'edit_file', 'glob', 'grep'],
      target: 'local',
      priority: 100,
    },
    // å¿…é¡»äº‘ç«¯æ‰§è¡Œ
    {
      pattern: ['cross_project_search', 'semantic_search'],
      target: 'cloud',
      priority: 90,
    },
    // æ··åˆæ¨¡å¼
    {
      pattern: ['refactor', 'implement_feature'],
      target: 'hybrid',
      priority: 80,
      condition: (task) => this.estimateComplexity(task) > 5,
    },
  ];

  route(task: Task): TaskTarget {
    // ... è·¯ç”±é€»è¾‘
  }
}
```

---

## äº‘ç«¯ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿ

### æ•°æ®åº“è®¾è®¡

```sql
CREATE TABLE cloud_tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  device_id UUID REFERENCES devices(id),
  session_id UUID REFERENCES sessions(id),
  type VARCHAR(50) NOT NULL,
  status VARCHAR(20) NOT NULL DEFAULT 'pending',
  priority INTEGER DEFAULT 0,
  input JSONB NOT NULL,
  output JSONB,
  error TEXT,
  progress REAL DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ
);

CREATE INDEX idx_cloud_tasks_pending
  ON cloud_tasks (user_id, status, priority DESC, created_at)
  WHERE status = 'pending';
```

### ä»»åŠ¡çŠ¶æ€æµè½¬

```
pending â†’ processing â†’ completed
              â†“
           failed
              â†“
           retrying â†’ processing
```

---

## å¤šä»£ç†äº‘ç«¯è°ƒåº¦ (Gen 7)

### ä¸“ä¸šåŒ– Agent è®¾è®¡

| Agent | èŒè´£ | å·¥å…·æƒé™ | ç‰¹ç‚¹ |
|-------|------|----------|------|
| **PlannerAgent** | ä»»åŠ¡åˆ†è§£ã€æ‰§è¡Œè®¡åˆ’ | todo_write, task_split | å…¨å±€è§†é‡ |
| **CoderAgent** | ä»£ç å®ç° | edit_file, write_file | ä»£ç ä¸“å®¶ |
| **ReviewerAgent** | ä»£ç å®¡æŸ¥ | read_file, code_analysis | è´¨é‡æŠŠå…³ |
| **ResearcherAgent** | çŸ¥è¯†æ£€ç´¢ | semantic_search, web_fetch | RAG å¢å¼º |

### è°ƒåº¦æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ â†’ Planner åˆ†è§£ä»»åŠ¡
              â†“
         å¹¶è¡Œåˆ†é…ç»™ä¸“ä¸š Agent
              â†“
         å„ Agent ç‹¬ç«‹æ‰§è¡Œ
              â†“
         Reviewer å®¡æŸ¥ç»“æœ
              â†“
         æ±‡æ€»è¿”å›ç”¨æˆ·
```

---

## è·¨è®¾å¤‡ä»»åŠ¡ç»­æ¥

### è®¾è®¡åŸç†

- æ¯ä¸ªä»»åŠ¡å…³è” `device_id`ï¼ˆåˆ›å»ºè®¾å¤‡ï¼‰
- ä»»åŠ¡å¯æ ‡è®°ä¸º `transferable`ï¼ˆå¯è½¬ç§»ï¼‰
- æ–°è®¾å¤‡ä¸Šçº¿æ—¶æ‹‰å–å¯ç»­æ¥ä»»åŠ¡

### ç»­æ¥æ¡ä»¶

```typescript
// å¯ç»­æ¥æ¡ä»¶
{
  status: 'processing',
  device_id: originalDeviceId,  // åŸè®¾å¤‡
  transferable: true,
  last_heartbeat: { $lt: 5åˆ†é’Ÿå‰ }  // åŸè®¾å¤‡è¶…æ—¶
}
```

---

## ä»£é™…èƒ½åŠ›å¢å¼ºæ˜ å°„

| ä»£é™… | æ–°å¢äº‘ç«¯èƒ½åŠ› |
|------|--------------|
| Gen5 | äº‘ç«¯å‘é‡å­˜å‚¨ã€è·¨é¡¹ç›®è®°å¿† |
| Gen6 | äº‘ç«¯ Screenshot åˆ†æ |
| Gen7 | å¤šä»£ç†äº‘ç«¯è°ƒåº¦ |
| Gen8 | ç­–ç•¥å­¦ä¹ å’Œä¼˜åŒ– |

---

## å®‰å…¨è€ƒè™‘

1. **ç”¨æˆ· API Key éš”ç¦»**: æ¯ä¸ªç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„ API Key
2. **æ•°æ®åŠ å¯†**: æ•æ„Ÿæ•°æ®ä¼ è¾“ä½¿ç”¨ TLSï¼Œå­˜å‚¨ä½¿ç”¨ AES-256
3. **è®¿é—®æ§åˆ¶**: RLS ç­–ç•¥ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
4. **å®¡è®¡æ—¥å¿—**: æ‰€æœ‰äº‘ç«¯æ“ä½œè®°å½•å®¡è®¡æ—¥å¿—

---

## æ–‡ä»¶ç»“æ„

```
src/main/cloud/
â”œâ”€â”€ TaskRouter.ts        # ä»»åŠ¡è·¯ç”±å™¨
â”œâ”€â”€ CloudClient.ts       # äº‘ç«¯å®¢æˆ·ç«¯
â”œâ”€â”€ TaskQueue.ts         # ä»»åŠ¡é˜Ÿåˆ—
â””â”€â”€ SyncEngine.ts        # åŒæ­¥å¼•æ“

cloud-agent/api/
â”œâ”€â”€ tasks/
â”‚   â”œâ”€â”€ create.ts        # åˆ›å»ºä»»åŠ¡
â”‚   â”œâ”€â”€ status.ts        # æŸ¥è¯¢çŠ¶æ€
â”‚   â””â”€â”€ execute.ts       # æ‰§è¡Œä»»åŠ¡
â””â”€â”€ agents/
    â”œâ”€â”€ planner.ts       # è§„åˆ’ Agent
    â”œâ”€â”€ coder.ts         # ç¼–ç  Agent
    â””â”€â”€ reviewer.ts      # å®¡æŸ¥ Agent
```
