# äº‘ç«¯ä¸æœ¬åœ°ååŒæ¶æ„

> Gen 5-8 æ¼”è¿›çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½

## æ¶æ„æ€»è§ˆ

äº‘ç«¯ä¸æœ¬åœ°ååŒå®ç°ï¼š
- **æœ¬åœ°**ï¼šè´Ÿè´£"æ‰‹è„š"ï¼ˆæ–‡ä»¶æ“ä½œã€ç»ˆç«¯æ‰§è¡Œã€UI äº¤äº’ï¼‰
- **äº‘ç«¯**ï¼šè´Ÿè´£"å¤§è„‘"ï¼ˆå¤æ‚æ¨ç†ã€å¤šä»£ç†è°ƒåº¦ã€è·¨è®¾å¤‡è®°å¿†ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Cloud-Local Hybrid Architecture                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     Local Client (Electron App)                          â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚   â”‚  â”‚  Local Agent   â”‚ â”‚  Task Router   â”‚ â”‚  Sync Engine   â”‚               â”‚   â”‚
â”‚   â”‚  â”‚    Loop        â”‚ â”‚                â”‚ â”‚                â”‚               â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚   â”‚          â”‚                  â”‚                  â”‚                         â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚   â”‚  â”‚                   Local Executor                      â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â”‚  File   â”‚ â”‚  Shell  â”‚ â”‚   Git   â”‚ â”‚Computer â”‚    â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â”‚  Ops    â”‚ â”‚  Exec   â”‚ â”‚   Ops   â”‚ â”‚  Use    â”‚    â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚               â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                             â”‚
â”‚                          WebSocket â”‚ + REST API                                  â”‚
â”‚                                    â”‚                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        Supabase Cloud Platform                           â”‚   â”‚
â”‚   â”‚                                                                          â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚                     Edge Functions Layer                         â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚   Task     â”‚ â”‚  Agent     â”‚ â”‚  Workflow  â”‚ â”‚  Strategy  â”‚   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚  Router    â”‚ â”‚ Scheduler  â”‚ â”‚  Engine    â”‚ â”‚  Optimizer â”‚   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â”‚                                                                          â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚                     Data Layer                                   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚   Task     â”‚ â”‚   Agent    â”‚ â”‚  Vector    â”‚ â”‚  Strategy  â”‚   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚   Queue    â”‚ â”‚   State    â”‚ â”‚   Store    â”‚ â”‚   Cache    â”‚   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚ (Postgres) â”‚ â”‚ (Postgres) â”‚ â”‚ (pgvector) â”‚ â”‚  (Redis)   â”‚   â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â”‚                                                                          â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚   â”‚  â”‚                     AI Services Layer                            â”‚    â”‚   â”‚
â”‚   â”‚  â”‚              Claude Agent SDK (Anthropic)                        â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚ Planner â”‚ â”‚  Coder  â”‚ â”‚Reviewer â”‚ â”‚Researcherâ”‚               â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â”‚  Agent  â”‚ â”‚  Agent  â”‚ â”‚  Agent  â”‚ â”‚  Agent  â”‚               â”‚    â”‚   â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚    â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä»»åŠ¡åˆ†ç±»ä¸è·¯ç”±ç­–ç•¥

### ä»»åŠ¡åˆ†ç±»çŸ©é˜µ

| ä»»åŠ¡ç±»å‹ | æ‰§è¡Œä½ç½® | åŸå›  | ç¤ºä¾‹ |
|----------|----------|------|------|
| **æ–‡ä»¶ç³»ç»Ÿæ“ä½œ** | ğŸ  æœ¬åœ° | éœ€è¦æœ¬åœ°æ–‡ä»¶è®¿é—®æƒé™ | read_file, write_file, edit_file |
| **ç»ˆç«¯å‘½ä»¤æ‰§è¡Œ** | ğŸ  æœ¬åœ° | éœ€è¦æœ¬åœ°ç¯å¢ƒå’Œå·¥å…·é“¾ | bash, npm, git |
| **Computer Use** | ğŸ  æœ¬åœ° | éœ€è¦æœ¬åœ°å±å¹•å’Œè¾“å…¥è®¾å¤‡ | screenshot, click, type |
| **æ•æ„Ÿä»£ç å¤„ç†** | ğŸ  æœ¬åœ° | éšç§å’Œå®‰å…¨è€ƒè™‘ | å«å¯†é’¥/å‡­è¯çš„ä»£ç  |
| **å®æ—¶ UI äº¤äº’** | ğŸ  æœ¬åœ° | éœ€è¦å³æ—¶å“åº” | ask_user_question |
| **ä»£ç å®¡æŸ¥åˆ†æ** | â˜ï¸ äº‘ç«¯ | çº¯æ¨ç†ä»»åŠ¡ï¼Œæ— æœ¬åœ°ä¾èµ– | review_code |
| **æ–‡æ¡£ç”Ÿæˆ** | â˜ï¸ äº‘ç«¯ | å¯ç¦»çº¿å®Œæˆï¼Œç»“æœåŒæ­¥ | generate_docs |
| **å¤šæ–‡ä»¶é‡æ„è§„åˆ’** | â˜ï¸ äº‘ç«¯ | å¤æ‚æ¨ç†ï¼Œäº‘ç«¯ç®—åŠ›æ›´å¼º | plan_refactor |
| **è·¨é¡¹ç›®çŸ¥è¯†æ£€ç´¢** | â˜ï¸ äº‘ç«¯ | äº‘ç«¯å‘é‡åº“ç»Ÿä¸€ç®¡ç† | semantic_search |
| **å¤šä»£ç†ååŒ** | â˜ï¸ äº‘ç«¯ | äº‘ç«¯è°ƒåº¦å¤šä¸ª Agent æ›´é«˜æ•ˆ | multi_agent_task |
| **å¤§å‹é‡æ„æ‰§è¡Œ** | ğŸ”„ æ··åˆ | äº‘ç«¯è§„åˆ’ + æœ¬åœ°æ‰§è¡Œ | refactor_module |

### ä»»åŠ¡è·¯ç”±å™¨è®¾è®¡

```typescript
// src/main/cloud/TaskRouter.ts

export type TaskTarget = 'local' | 'cloud' | 'hybrid';

export interface RoutingRule {
  pattern: RegExp | string[];
  target: TaskTarget;
  priority: number;
  condition?: (task: Task) => boolean;
}

export class TaskRouter {
  private rules: RoutingRule[] = [
    // å¿…é¡»æœ¬åœ°æ‰§è¡Œ
    {
      pattern: ['bash', 'read_file', 'write_file', 'edit_file', 'glob', 'grep'],
      target: 'local',
      priority: 100,
    },
    {
      pattern: ['screenshot', 'computer_use', 'click', 'type', 'scroll'],
      target: 'local',
      priority: 100,
    },
    {
      pattern: ['ask_user_question'],
      target: 'local',
      priority: 100,
    },

    // å¿…é¡»äº‘ç«¯æ‰§è¡Œ
    {
      pattern: ['cross_project_search', 'semantic_search'],
      target: 'cloud',
      priority: 90,
    },
    {
      pattern: ['spawn_multi_agent', 'agent_orchestrate'],
      target: 'cloud',
      priority: 90,
    },

    // æ··åˆæ¨¡å¼ï¼šæ ¹æ®ä»»åŠ¡å¤æ‚åº¦åˆ¤æ–­
    {
      pattern: ['refactor', 'implement_feature'],
      target: 'hybrid',
      priority: 80,
      condition: (task) => this.estimateComplexity(task) > 5,
    },

    // å¯äº‘ç«¯åŠ é€Ÿçš„çº¯æ¨ç†ä»»åŠ¡
    {
      pattern: ['code_review', 'generate_docs', 'explain_code'],
      target: 'cloud',
      priority: 70,
      condition: (task) => this.isCloudAvailable(),
    },

    // é»˜è®¤æœ¬åœ°
    {
      pattern: /.*/,
      target: 'local',
      priority: 0,
    },
  ];

  route(task: Task): TaskTarget {
    const sortedRules = [...this.rules].sort((a, b) => b.priority - a.priority);

    for (const rule of sortedRules) {
      if (this.matchRule(task, rule)) {
        if (!rule.condition || rule.condition(task)) {
          return rule.target;
        }
      }
    }

    return 'local';
  }

  private estimateComplexity(task: Task): number {
    let score = 0;
    if (task.metadata?.fileCount) score += task.metadata.fileCount;
    if (task.metadata?.estimatedChanges) score += task.metadata.estimatedChanges / 100;
    return score;
  }
}
```

---

## äº‘ç«¯ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿ

### æ•°æ®åº“è®¾è®¡

```sql
-- äº‘ç«¯ä»»åŠ¡é˜Ÿåˆ—è¡¨
CREATE TABLE cloud_tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  device_id UUID REFERENCES devices(id),
  session_id UUID REFERENCES sessions(id),

  -- ä»»åŠ¡å®šä¹‰
  type TEXT NOT NULL,                    -- 'code_review', 'refactor_plan', 'multi_agent'
  name TEXT NOT NULL,                    -- äººç±»å¯è¯»çš„ä»»åŠ¡åç§°
  description TEXT,                      -- ä»»åŠ¡æè¿°

  -- çŠ¶æ€ç®¡ç†
  status TEXT NOT NULL DEFAULT 'pending'
    CHECK (status IN ('pending', 'queued', 'running', 'paused', 'completed', 'failed', 'cancelled')),
  priority INTEGER DEFAULT 5 CHECK (priority BETWEEN 1 AND 10),

  -- è¾“å…¥è¾“å‡º
  input JSONB NOT NULL,                  -- ä»»åŠ¡è¾“å…¥å‚æ•°
  result JSONB,                          -- æ‰§è¡Œç»“æœ
  error JSONB,                           -- é”™è¯¯ä¿¡æ¯

  -- æ‰§è¡Œå…ƒæ•°æ®
  agent_type TEXT,                       -- ä½¿ç”¨çš„ Agent ç±»å‹
  agent_config JSONB,                    -- Agent é…ç½®
  tokens_used INTEGER DEFAULT 0,
  estimated_tokens INTEGER,

  -- è¿›åº¦è¿½è¸ª
  progress INTEGER DEFAULT 0 CHECK (progress BETWEEN 0 AND 100),
  current_step TEXT,
  total_steps INTEGER,
  completed_steps INTEGER DEFAULT 0,

  -- æ—¶é—´æˆ³
  created_at TIMESTAMPTZ DEFAULT now(),
  queued_at TIMESTAMPTZ,
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,

  -- è¶…æ—¶å’Œé‡è¯•
  timeout_seconds INTEGER DEFAULT 3600,  -- é»˜è®¤ 1 å°æ—¶è¶…æ—¶
  retry_count INTEGER DEFAULT 0,
  max_retries INTEGER DEFAULT 3,

  -- ä¾èµ–å…³ç³»
  parent_task_id UUID REFERENCES cloud_tasks(id),
  depends_on UUID[] DEFAULT '{}'::UUID[],

  -- é€šçŸ¥è®¾ç½®
  notify_on_complete BOOLEAN DEFAULT true,
  notify_channels TEXT[] DEFAULT '{}'::TEXT[]  -- 'push', 'email', 'webhook'
);

-- ä»»åŠ¡æ—¥å¿—è¡¨
CREATE TABLE task_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id UUID NOT NULL REFERENCES cloud_tasks(id) ON DELETE CASCADE,
  level TEXT NOT NULL CHECK (level IN ('debug', 'info', 'warn', 'error')),
  message TEXT NOT NULL,
  metadata JSONB,
  agent_id TEXT,
  step_index INTEGER,
  created_at TIMESTAMPTZ DEFAULT now()
);

-- ä»»åŠ¡æ‰§è¡Œæ­¥éª¤è¡¨
CREATE TABLE task_steps (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  task_id UUID NOT NULL REFERENCES cloud_tasks(id) ON DELETE CASCADE,
  step_index INTEGER NOT NULL,
  name TEXT NOT NULL,
  description TEXT,
  status TEXT NOT NULL DEFAULT 'pending'
    CHECK (status IN ('pending', 'running', 'completed', 'failed', 'skipped')),
  input JSONB,
  output JSONB,
  error JSONB,
  started_at TIMESTAMPTZ,
  completed_at TIMESTAMPTZ,
  duration_ms INTEGER,
  -- æœ¬åœ°æ‰§è¡Œæ ‡è®°
  requires_local_execution BOOLEAN DEFAULT false,
  local_execution_request JSONB,
  local_execution_result JSONB,
  UNIQUE (task_id, step_index)
);

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_cloud_tasks_user_status ON cloud_tasks(user_id, status);
CREATE INDEX idx_cloud_tasks_priority_status ON cloud_tasks(priority DESC, status)
  WHERE status IN ('pending', 'queued');
CREATE INDEX idx_task_logs_task_id ON task_logs(task_id, created_at DESC);

-- å®æ—¶è®¢é˜…æ”¯æŒ
ALTER PUBLICATION supabase_realtime ADD TABLE cloud_tasks;
ALTER PUBLICATION supabase_realtime ADD TABLE task_steps;
```

### ä»»åŠ¡çŠ¶æ€æµè½¬

```
pending â†’ queued â†’ running â†’ completed
                      â†“
                   failed
                      â†“
                  retrying â†’ running
                      â†“
                  cancelled
```

---

## æ··åˆæ‰§è¡Œæ¨¡å¼ (Hybrid Mode)

### æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Hybrid Task Execution Flow                                   â”‚
â”‚                     (äº‘ç«¯è§„åˆ’ + æœ¬åœ°æ‰§è¡Œ + äº‘ç«¯å®¡æŸ¥)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·è¯·æ±‚: "é‡æ„ auth æ¨¡å—ï¼Œæå–å…¬å…±é€»è¾‘"
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1: äº‘ç«¯è§„åˆ’ (Cloud Planning)                                               â”‚
â”‚                                                                                  â”‚
â”‚   Planner Agent (Claude) ç”Ÿæˆé‡æ„è®¡åˆ’:                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Step 1: åˆ›å»º src/utils/authHelpers.ts [LOCAL: write_file]               â”‚   â”‚
â”‚   â”‚ Step 2: æå– validateToken å‡½æ•° [LOCAL: edit_file]                      â”‚   â”‚
â”‚   â”‚ Step 3: æå– refreshSession å‡½æ•° [LOCAL: edit_file]                     â”‚   â”‚
â”‚   â”‚ Step 4: æ›´æ–° AuthService å¯¼å…¥ [LOCAL: edit_file]                        â”‚   â”‚
â”‚   â”‚ Step 5: è¿è¡Œæµ‹è¯•éªŒè¯ [LOCAL: bash npm test]                             â”‚   â”‚
â”‚   â”‚ Step 6: ä»£ç å®¡æŸ¥ [CLOUD: review]                                        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ è®¡åˆ’ä¸‹å‘
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 2: æœ¬åœ°æ‰§è¡Œ (Local Execution)                                              â”‚
â”‚                                                                                  â”‚
â”‚   Local Agent Loop:                                                              â”‚
â”‚   FOR EACH step WHERE requires_local_execution:                                  â”‚
â”‚     â”œâ”€ Step 1: write_file('src/utils/authHelpers.ts', content)                  â”‚
â”‚     â”œâ”€ Step 2-4: edit_file ä¿®æ”¹ç›¸å…³æ–‡ä»¶                                         â”‚
â”‚     â””â”€ Step 5: bash('npm test') â†’ ä¸ŠæŠ¥ç»“æœåˆ°äº‘ç«¯                                â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚ æ‰§è¡Œç»“æœ
                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3: äº‘ç«¯å®¡æŸ¥ (Cloud Review)                                                 â”‚
â”‚                                                                                  â”‚
â”‚   Reviewer Agent å®¡æŸ¥æŠ¥å‘Š:                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ âœ… ä»£ç ç»“æ„æ”¹å–„                                                         â”‚   â”‚
â”‚   â”‚ âœ… å‡½æ•°èŒè´£å•ä¸€                                                         â”‚   â”‚
â”‚   â”‚ âš ï¸ å»ºè®®: æ·»åŠ  JSDoc æ³¨é‡Š                                                â”‚   â”‚
â”‚   â”‚ âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡                                                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                              é€šçŸ¥ç”¨æˆ·å®Œæˆ
```

---

## å¤šä»£ç†äº‘ç«¯è°ƒåº¦ (Gen 7)

### ä¸“ä¸šåŒ– Agent è®¾è®¡ç†å¿µ

**æ ¸å¿ƒæ¦‚å¿µ**: ä¸“ä¸šåŒ– Agent ä¸æ˜¯ä½¿ç”¨ä¸åŒçš„æ¨¡å‹ï¼Œè€Œæ˜¯**åŒä¸€ä¸ªåº•å±‚æ¨¡å‹ + ä¸åŒçš„ System Prompt + ä¸åŒçš„å·¥å…·é›†**ï¼Œè®©æ¨¡å‹æ‰®æ¼”ä¸åŒçš„ä¸“ä¸šè§’è‰²ã€‚

### å¤šæ¨¡å‹æ”¯æŒï¼ˆv0.6.0 å®ç°ï¼‰

äº‘ç«¯ Agent é€šè¿‡ `ModelClient` ç»Ÿä¸€æŠ½è±¡å±‚æ”¯æŒå¤šä¸ªæ¨¡å‹æä¾›å•†ï¼š

| Provider | æ¨¡å‹ | ç‰¹ç‚¹ |
|----------|------|------|
| DeepSeek | deepseek-chat | é»˜è®¤é¦–é€‰ï¼Œæ€§ä»·æ¯”é«˜ |
| OpenAI | gpt-4o | ç»¼åˆèƒ½åŠ›å¼º |
| Anthropic | claude-sonnet-4 | æ¨ç†èƒ½åŠ›å¼º |

**æ¨¡å‹é€‰æ‹©ä¼˜å…ˆçº§**: DeepSeek > OpenAI > Anthropicï¼ˆæŒ‰å¯ç”¨æ€§è‡ªåŠ¨å›é€€ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ä¸“ä¸šåŒ– Agent æ¶æ„                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚   ModelClient ç»Ÿä¸€æŠ½è±¡å±‚                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  DeepSeek API  â”‚  OpenAI API  â”‚  Anthropic API                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚           â–¼               â–¼               â–¼               â–¼                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚  Planner    â”‚ â”‚   Coder     â”‚ â”‚  Reviewer   â”‚ â”‚ Researcher  â”‚              â”‚
â”‚   â”‚  Agent      â”‚ â”‚   Agent     â”‚ â”‚   Agent     â”‚ â”‚   Agent     â”‚              â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚   â”‚ System:     â”‚ â”‚ System:     â”‚ â”‚ System:     â”‚ â”‚ System:     â”‚              â”‚
â”‚   â”‚ "ä½ æ˜¯ä»»åŠ¡   â”‚ â”‚ "ä½ æ˜¯ä»£ç    â”‚ â”‚ "ä½ æ˜¯ä»£ç    â”‚ â”‚ "ä½ æ˜¯æŠ€æœ¯   â”‚              â”‚
â”‚   â”‚  è§„åˆ’ä¸“å®¶"  â”‚ â”‚  å®ç°ä¸“å®¶"  â”‚ â”‚  å®¡æŸ¥ä¸“å®¶"  â”‚ â”‚  ç ”ç©¶ä¸“å®¶"  â”‚              â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚   â”‚ Tools:      â”‚ â”‚ Tools:      â”‚ â”‚ Tools:      â”‚ â”‚ Tools:      â”‚              â”‚
â”‚   â”‚ - analyze   â”‚ â”‚ (æ— å·¥å…·,   â”‚ â”‚ - analyze   â”‚ â”‚ - search    â”‚              â”‚
â”‚   â”‚ - estimate  â”‚ â”‚  åªç”Ÿæˆ)   â”‚ â”‚ - check     â”‚ â”‚ - web_fetch â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent å®šä¹‰

```typescript
// supabase/functions/shared/agents.ts

export interface AgentSpec {
  id: string;
  name: string;
  role: string;
  description: string;
  capabilities: string[];
  systemPrompt: string;
  modelConfig: {
    provider: ModelProvider;
    model: string;
    maxTokens: number;
    temperature?: number;
  };
  tools: string[];
}

export const AGENT_SPECS: Record<string, AgentSpec> = {
  planner: {
    id: 'planner',
    name: 'Planner Agent',
    role: 'ä»»åŠ¡è§„åˆ’ä¸åˆ†è§£',
    description: 'åˆ†æå¤æ‚ä»»åŠ¡ï¼Œç”Ÿæˆå¯æ‰§è¡Œçš„æ­¥éª¤è®¡åˆ’',
    capabilities: ['task_decomposition', 'dependency_analysis', 'resource_estimation'],
    systemPrompt: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»»åŠ¡è§„åˆ’åŠ©æ‰‹ã€‚ä½ çš„èŒè´£æ˜¯:
1. åˆ†æç”¨æˆ·çš„å¤æ‚éœ€æ±‚
2. å°†ä»»åŠ¡åˆ†è§£ä¸ºåŸå­åŒ–ã€å¯æ‰§è¡Œçš„æ­¥éª¤
3. è¯†åˆ«æ­¥éª¤ä¹‹é—´çš„ä¾èµ–å…³ç³»
4. æ ‡è®°æ¯ä¸ªæ­¥éª¤éœ€è¦åœ¨æœ¬åœ°è¿˜æ˜¯äº‘ç«¯æ‰§è¡Œ
5. ä¼°ç®—æ¯ä¸ªæ­¥éª¤çš„èµ„æºéœ€æ±‚

è¾“å‡ºæ ¼å¼è¦æ±‚ JSON ç»“æ„åŒ–è®¡åˆ’ã€‚`,
    modelConfig: {
      provider: 'deepseek',
      model: 'deepseek-chat',
      maxTokens: 8000,
      temperature: 0.3,
    },
    tools: ['analyze_codebase', 'estimate_complexity'],
  },

  coder: {
    id: 'coder',
    name: 'Coder Agent',
    role: 'ä»£ç å®ç°',
    description: 'æ ¹æ®è®¡åˆ’ç”Ÿæˆé«˜è´¨é‡ä»£ç ',
    capabilities: ['code_generation', 'refactoring', 'bug_fixing'],
    systemPrompt: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç¼–ç¨‹åŠ©æ‰‹ã€‚ä½ çš„èŒè´£æ˜¯:
1. æ ¹æ®è§„åˆ’æ­¥éª¤ç”Ÿæˆä»£ç 
2. éµå¾ªé¡¹ç›®çš„ä»£ç é£æ ¼å’Œè§„èŒƒ
3. ç¼–å†™æ¸…æ™°ã€å¯ç»´æŠ¤çš„ä»£ç 
4. å¤„ç†è¾¹ç•Œæƒ…å†µå’Œé”™è¯¯

ä½ ç”Ÿæˆçš„ä»£ç å°†ç”±æœ¬åœ°æ‰§è¡Œå™¨å†™å…¥æ–‡ä»¶ã€‚`,
    modelConfig: {
      provider: 'deepseek',
      model: 'deepseek-coder',
      maxTokens: 16000,
      temperature: 0.2,
    },
    tools: [],  // Coder åªç”Ÿæˆä»£ç ï¼Œä¸æ‰§è¡Œå·¥å…·
  },

  reviewer: {
    id: 'reviewer',
    name: 'Reviewer Agent',
    role: 'ä»£ç å®¡æŸ¥',
    description: 'å®¡æŸ¥ä»£ç è´¨é‡ã€å®‰å…¨æ€§å’Œæœ€ä½³å®è·µ',
    capabilities: ['code_review', 'security_audit', 'performance_analysis'],
    systemPrompt: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»£ç å®¡æŸ¥åŠ©æ‰‹ã€‚ä½ çš„èŒè´£æ˜¯:
1. æ£€æŸ¥ä»£ç è´¨é‡å’Œå¯è¯»æ€§
2. è¯†åˆ«æ½œåœ¨çš„ bug å’Œå®‰å…¨æ¼æ´
3. éªŒè¯æ˜¯å¦éµå¾ªæœ€ä½³å®è·µ
4. æä¾›æ”¹è¿›å»ºè®®`,
    modelConfig: {
      provider: 'deepseek',
      model: 'deepseek-reasoner',
      maxTokens: 8000,
      temperature: 0.4,
    },
    tools: ['analyze_code', 'check_security'],
  },

  researcher: {
    id: 'researcher',
    name: 'Researcher Agent',
    role: 'æŠ€æœ¯ç ”ç©¶',
    description: 'æœç´¢æ–‡æ¡£ã€æœ€ä½³å®è·µå’Œè§£å†³æ–¹æ¡ˆ',
    capabilities: ['documentation_search', 'best_practice_lookup', 'solution_research'],
    systemPrompt: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯ç ”ç©¶åŠ©æ‰‹ã€‚ä½ çš„èŒè´£æ˜¯:
1. æœç´¢ç›¸å…³æŠ€æœ¯æ–‡æ¡£å’Œæœ€ä½³å®è·µ
2. åˆ†æç±»ä¼¼é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ
3. æä¾›æŠ€æœ¯å»ºè®®å’Œå‚è€ƒ
4. æ€»ç»“ç ”ç©¶å‘ç°

ä½ å¯ä»¥è®¿é—®å‘é‡æ•°æ®åº“è¿›è¡Œè¯­ä¹‰æœç´¢ã€‚`,
    modelConfig: {
      provider: 'deepseek',
      model: 'deepseek-chat',
      maxTokens: 4000,
      temperature: 0.5,
    },
    tools: ['semantic_search', 'web_fetch'],
  },
};
```

### å¤šä»£ç†è°ƒåº¦æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ â†’ Planner åˆ†è§£ä»»åŠ¡
              â†“
         å¹¶è¡Œåˆ†é…ç»™ä¸“ä¸š Agent
              â†“
         å„ Agent ç‹¬ç«‹æ‰§è¡Œ
              â†“
         Reviewer å®¡æŸ¥ç»“æœ
              â†“
         æ±‡æ€»è¿”å›ç”¨æˆ·
```

---

## è·¨è®¾å¤‡ä»»åŠ¡ç»­æ¥

### è®¾è®¡åŸç†

- æ¯ä¸ªä»»åŠ¡å…³è” `device_id`ï¼ˆåˆ›å»ºè®¾å¤‡ï¼‰
- ä»»åŠ¡å¯æ ‡è®°ä¸º `transferable`ï¼ˆå¯è½¬ç§»ï¼‰
- æ–°è®¾å¤‡ä¸Šçº¿æ—¶æ‹‰å–å¯ç»­æ¥ä»»åŠ¡

### ç»­æ¥æ¡ä»¶

```typescript
// å¯ç»­æ¥æ¡ä»¶
{
  status: 'processing',
  device_id: originalDeviceId,  // åŸè®¾å¤‡
  transferable: true,
  last_heartbeat: { $lt: 5åˆ†é’Ÿå‰ }  // åŸè®¾å¤‡è¶…æ—¶
}
```

### ç»­æ¥æµç¨‹

```
è®¾å¤‡ A åˆ›å»ºä»»åŠ¡ â†’ äº‘ç«¯å¼€å§‹æ‰§è¡Œ â†’ è®¾å¤‡ A ç¦»çº¿
                                      â†“
è®¾å¤‡ B ä¸Šçº¿ â†’ æ£€æµ‹åˆ°å¯ç»­æ¥ä»»åŠ¡ â†’ æ¥ç®¡æœ¬åœ°æ‰§è¡Œæ­¥éª¤
                                      â†“
                               ç»§ç»­ä»»åŠ¡ç›´åˆ°å®Œæˆ
```

---

## ä»£é™…èƒ½åŠ›å¢å¼ºæ˜ å°„

| ä»£é™… | æ–°å¢äº‘ç«¯èƒ½åŠ› |
|------|--------------|
| Gen5 | äº‘ç«¯å‘é‡å­˜å‚¨ã€è·¨é¡¹ç›®è®°å¿† |
| Gen6 | äº‘ç«¯ Screenshot åˆ†æ |
| Gen7 | å¤šä»£ç†äº‘ç«¯è°ƒåº¦ |
| Gen8 | ç­–ç•¥å­¦ä¹ å’Œä¼˜åŒ– |

---

## å®‰å…¨è€ƒè™‘

### API Key æƒé™ç³»ç»Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Key æƒé™æ¨¡å‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   ç®¡ç†å‘˜ç”¨æˆ·                     æ™®é€šç”¨æˆ·                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ ç³»ç»Ÿ Key    â”‚ â† ä¼˜å…ˆ       â”‚ ç”¨æˆ· Key    â”‚ â† å”¯ä¸€æ¥æº      â”‚
â”‚   â”‚ (ç¯å¢ƒå˜é‡)  â”‚               â”‚ (æ•°æ®åº“)    â”‚                 â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚   â”‚ ç”¨æˆ· Key    â”‚ â† å›é€€                                        â”‚
â”‚   â”‚ (æ•°æ®åº“)    â”‚                                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                  â”‚
â”‚   æœªç™»å½•ç”¨æˆ· â†’ 401 æ‹’ç»è®¿é—®                                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®ç°ä½ç½®**: `cloud-agent/lib/apiKeys.ts`

```typescript
// ç®¡ç†å‘˜åˆ¤æ–­
function isAdmin(user: User): boolean {
  return user.role === 'admin' || ADMIN_EMAILS.includes(user.email);
}

// Key è·å–é€»è¾‘
async function getApiKey(userId: string, keyType: ApiKeyType) {
  if (isAdmin(user)) {
    // ç®¡ç†å‘˜ï¼šä¼˜å…ˆç³»ç»Ÿ Key
    const systemKey = process.env[`${keyType.toUpperCase()}_API_KEY`];
    if (systemKey) return { key: systemKey, source: 'system' };
  }
  // æ‰€æœ‰ç”¨æˆ·ï¼šæŸ¥è¯¢è‡ªå·±é…ç½®çš„ Key
  return getUserConfiguredKey(userId, keyType);
}
```

### å…¶ä»–å®‰å…¨æªæ–½

1. **ç”¨æˆ· API Key éš”ç¦»**: æ¯ä¸ªç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„ API Keyï¼Œäº‘ç«¯ä¸å­˜å‚¨æ˜æ–‡
2. **æ•°æ®åŠ å¯†**: æ•æ„Ÿæ•°æ®ä¼ è¾“ä½¿ç”¨ TLSï¼Œå­˜å‚¨ä½¿ç”¨ AES-256
3. **è®¿é—®æ§åˆ¶**: RLS ç­–ç•¥ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
4. **å®¡è®¡æ—¥å¿—**: æ‰€æœ‰äº‘ç«¯æ“ä½œè®°å½•å®¡è®¡æ—¥å¿—
5. **è¶…æ—¶ä¿æŠ¤**: ä»»åŠ¡é»˜è®¤ 1 å°æ—¶è¶…æ—¶ï¼Œé˜²æ­¢èµ„æºæ»¥ç”¨

---

## æ–‡ä»¶ç»“æ„

### å®¢æˆ·ç«¯ Orchestratorï¼ˆv0.6.4 å®ç°ï¼‰

```
src/main/orchestrator/
â”œâ”€â”€ types.ts                    # æ ¸å¿ƒç±»å‹å®šä¹‰
â”œâ”€â”€ index.ts                    # æ¨¡å—å¯¼å‡ºå…¥å£
â”œâ”€â”€ UnifiedOrchestrator.ts      # ç»Ÿä¸€æŒ‡æŒ¥å®¶ï¼ˆæ ¸å¿ƒåè°ƒï¼‰
â”œâ”€â”€ ExecutionRouter.ts          # æ‰§è¡Œè·¯ç”±å™¨ï¼ˆ4 å±‚ä¼˜å…ˆçº§å†³ç­–ï¼‰
â”œâ”€â”€ TaskAnalyzer.ts             # ä»»åŠ¡åˆ†æå™¨ï¼ˆ5 ç»´åº¦ç‰¹å¾æå–ï¼‰
â”œâ”€â”€ LocalExecutor.ts            # æœ¬åœ°æ‰§è¡Œå™¨
â”œâ”€â”€ CloudExecutor.ts            # äº‘ç«¯æ‰§è¡Œå™¨
â”œâ”€â”€ CheckpointManager.ts        # æ–­ç‚¹ç»­ä¼ ç®¡ç†ï¼ˆv0.6.1ï¼‰
â”œâ”€â”€ RealtimeChannel.ts          # WebSocket å®æ—¶é€šä¿¡ï¼ˆv0.6.1ï¼‰
â”œâ”€â”€ agents/                     # å¤š Agent è°ƒåº¦ç³»ç»Ÿï¼ˆv0.6.2ï¼‰
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ types.ts               # Agent è§’è‰²å’Œèƒ½åŠ›å®šä¹‰
â”‚   â”œâ”€â”€ AgentRegistry.ts       # Agent æ³¨å†Œè¡¨
â”‚   â”œâ”€â”€ AgentExecutor.ts       # Agent æ‰§è¡Œå™¨
â”‚   â””â”€â”€ AgentScheduler.ts      # è°ƒåº¦å™¨ï¼ˆ4 ç§è°ƒåº¦ç­–ç•¥ï¼‰
â””â”€â”€ strategy/                   # ç­–ç•¥æ¼”è¿›ç³»ç»Ÿï¼ˆv0.6.2ï¼‰
    â”œâ”€â”€ index.ts
    â”œâ”€â”€ types.ts               # ç­–ç•¥ç±»å‹å®šä¹‰
    â”œâ”€â”€ StrategyManager.ts     # ç­–ç•¥ç®¡ç†ï¼ˆæ”¯æŒç”¨æˆ·åé¦ˆå­¦ä¹ ï¼‰
    â””â”€â”€ StrategySyncer.ts      # äº‘ç«¯åŒæ­¥ï¼ˆå†²çªæ£€æµ‹ï¼‰

src/main/cloud/
â”œâ”€â”€ TaskRouter.ts           # ä»»åŠ¡è·¯ç”±å™¨
â”œâ”€â”€ CloudClient.ts          # äº‘ç«¯å®¢æˆ·ç«¯
â”œâ”€â”€ CloudTaskService.ts     # ä»»åŠ¡æœåŠ¡
â”œâ”€â”€ HybridTaskCoordinator.ts # æ··åˆä»»åŠ¡åè°ƒå™¨
â””â”€â”€ SyncEngine.ts           # åŒæ­¥å¼•æ“
```

### äº‘ç«¯é…ç½®æœåŠ¡ï¼ˆv0.7.22 å®ç°ï¼‰

```
src/main/services/cloud/
â”œâ”€â”€ CloudConfigService.ts     # äº‘ç«¯é…ç½®æ‹‰å–ä¸ç¼“å­˜
â”œâ”€â”€ FeatureFlagService.ts     # Feature Flags ä¾¿æ·å‡½æ•°
â””â”€â”€ builtinConfig.ts          # å†…ç½®ç¦»çº¿é…ç½®

vercel-api/api/v1/
â””â”€â”€ config.ts                 # äº‘ç«¯é…ç½® API
```

**CloudConfigService åŠŸèƒ½**ï¼š
- å¯åŠ¨æ—¶å¼‚æ­¥æ‹‰å–é…ç½®ï¼ˆä¸é˜»å¡çª—å£åˆ›å»ºï¼‰
- 1 å°æ—¶ç¼“å­˜ + ETag æ”¯æŒï¼ˆ304 Not Modifiedï¼‰
- æ‹‰å–å¤±è´¥é™é»˜é™çº§åˆ°å†…ç½®é…ç½®
- IPC æ¥å£ï¼š`CLOUD_CONFIG_REFRESH`ã€`CLOUD_CONFIG_GET_INFO`

**äº‘ç«¯é…ç½®å†…å®¹**ï¼š
| å­—æ®µ | è¯´æ˜ |
|------|------|
| prompts | å„ä»£é™… System Prompt |
| skills | Skill å®šä¹‰ |
| toolMeta | å·¥å…·æè¿°å’Œå‚æ•° |
| featureFlags | åŠŸèƒ½å¼€å…³ |
| uiStrings | UI æ–‡æ¡ˆï¼ˆä¸­/è‹±ï¼‰ |
| rules | Agent è§„åˆ™ |

**Feature Flags**ï¼š
| Flag | è¯´æ˜ |
|------|------|
| enableGen8 | æ˜¯å¦å¯ç”¨ Gen8 |
| enableComputerUse | æ˜¯å¦å¯ç”¨ Computer Use |
| enableCloudAgent | æ˜¯å¦å¯ç”¨äº‘ç«¯ Agent |
| maxIterations | Agent æœ€å¤§è¿­ä»£æ¬¡æ•° |

### äº‘ç«¯ APIï¼ˆv0.6.0 å®ç°ï¼‰

```
vercel-api/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ agent.ts            # Agent API (chat/plan)
â”‚   â”œâ”€â”€ health.ts           # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ update.ts           # ç‰ˆæœ¬æ›´æ–°
â”‚   â””â”€â”€ tools/
â”‚       â”œâ”€â”€ cloud-search.ts # DuckDuckGo æœç´¢
â”‚       â”œâ”€â”€ cloud-scrape.ts # ç½‘é¡µæŠ“å–
â”‚       â”œâ”€â”€ cloud-api.ts    # é€šç”¨ API è°ƒç”¨
â”‚       â””â”€â”€ cloud-memory.ts # å‘é‡å­˜å‚¨
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ agent/
â”‚   â”‚   â”œâ”€â”€ CloudAgentLoop.ts  # äº‘ç«¯ Agent å¾ªç¯
â”‚   â”‚   â””â”€â”€ ModelClient.ts     # å¤šæ¨¡å‹å®¢æˆ·ç«¯æŠ½è±¡
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â””â”€â”€ CloudToolRegistry.ts # å·¥å…·æ³¨å†Œè¡¨
â”‚   â”œâ”€â”€ apiKeys.ts          # API Key æƒé™ç®¡ç†
â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯
â”‚   â”œâ”€â”€ db.ts               # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ middleware.ts       # ä¸­é—´ä»¶
â”‚   â””â”€â”€ rateLimit.ts        # é€Ÿç‡é™åˆ¶
â””â”€â”€ vercel.json             # Vercel é…ç½®
```

### å¾…å®ç°

```
cloud-agent/api/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ planner.ts          # è§„åˆ’ Agentï¼ˆPhase 4ï¼‰
â”‚   â”œâ”€â”€ coder.ts            # ç¼–ç  Agentï¼ˆPhase 4ï¼‰
â”‚   â”œâ”€â”€ reviewer.ts         # å®¡æŸ¥ Agentï¼ˆPhase 4ï¼‰
â”‚   â””â”€â”€ researcher.ts       # ç ”ç©¶ Agentï¼ˆPhase 4ï¼‰
â””â”€â”€ scheduler/
    â””â”€â”€ index.ts            # å¤šä»£ç†è°ƒåº¦å™¨ï¼ˆPhase 4ï¼‰
```

---

## Orchestrator æ ¸å¿ƒæ¨¡å—è¯¦è§£

> v0.6.1 - v0.6.4 æ–°å¢

### UnifiedOrchestratorï¼ˆç»Ÿä¸€æŒ‡æŒ¥å®¶ï¼‰

ç³»ç»Ÿçš„æ ¸å¿ƒåè°ƒä¸­å¿ƒï¼Œè´Ÿè´£ï¼š
- æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼ˆ`execute()` / `executeStream()`ï¼‰
- åè°ƒä»»åŠ¡åˆ†æã€è·¯ç”±ã€æ‰§è¡Œä¸‰ä¸ªé˜¶æ®µ
- é€‰æ‹©æ‰§è¡Œä½ç½®ï¼ˆæœ¬åœ°/äº‘ç«¯/æ··åˆï¼‰
- ç®¡ç†æ‰§è¡Œå†å²å’ŒçŠ¶æ€ç›‘æ§
- å‘é€äº‹ä»¶æµï¼ˆanalysis:start/complete, routing:start/complete, execution:*ï¼‰

```typescript
// æ‰§è¡Œæµç¨‹
ç”¨æˆ·è¯·æ±‚ â†’ TaskAnalyzer â†’ ExecutionRouter â†’ LocalExecutor/CloudExecutor
              â†“                  â†“                    â†“
          ä»»åŠ¡ç‰¹å¾åˆ†æ      è·¯ç”±å†³ç­–ï¼ˆ4å±‚ï¼‰        æ‰§è¡Œå¹¶è¿”å›ç»“æœ
```

### TaskAnalyzerï¼ˆä»»åŠ¡åˆ†æå™¨ï¼‰

æ·±åº¦åˆ†æç”¨æˆ·è¯·æ±‚ï¼Œæå– 5 ä¸ªç»´åº¦çš„ç‰¹å¾ï¼š

| ç»´åº¦ | å¯é€‰å€¼ | è¯´æ˜ |
|------|--------|------|
| ä»»åŠ¡ç±»å‹ | research, coding, automation, data, general | åŸºäºå…³é”®è¯åŒ¹é… |
| æ‰€éœ€èƒ½åŠ› | file_access, shell, network, browser, memory, code_analysis, planning | å†³å®šæ‰§è¡Œä½ç½® |
| æ•æ„Ÿåº¦ | sensitive > internal > public | æ•æ„Ÿæ•°æ®å¼ºåˆ¶æœ¬åœ° |
| å¤æ‚åº¦ | simple < moderate < complex | åŸºäºè¯æ•°å’Œæ­¥éª¤æ•° |
| å®æ—¶æ€§ | realtime > async > batch | å½±å“æ‰§è¡Œç­–ç•¥ |

### ExecutionRouterï¼ˆæ‰§è¡Œè·¯ç”±å™¨ï¼‰

4 å±‚ä¼˜å…ˆçº§å†³ç­–ï¼š

| ä¼˜å…ˆçº§ | è§„åˆ™ç±»å‹ | ç¤ºä¾‹ |
|--------|----------|------|
| P1 | å®‰å…¨è§„åˆ™ | æ•æ„Ÿæ•°æ® â†’ å¼ºåˆ¶æœ¬åœ° |
| P2 | èƒ½åŠ›çº¦æŸ | file_access/shell â†’ local_only |
| P3 | æ•ˆç‡ä¼˜åŒ– | å¤æ‚ä»»åŠ¡ â†’ hybridï¼Œé•¿ä»»åŠ¡ â†’ cloud |
| P4 | ç”¨æˆ·åå¥½ | çœç”µæ¨¡å¼ â†’ ä¼˜å…ˆäº‘ç«¯ |

### CheckpointManagerï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰

æ”¯æŒä»»åŠ¡ä¸­æ–­åæ¢å¤ï¼š

```typescript
// æ ¸å¿ƒåŠŸèƒ½
- createCheckpoint()      // åˆ›å»ºæ£€æŸ¥ç‚¹
- updateProgress()        // æ›´æ–°è¿›åº¦ï¼ˆè‡ªåŠ¨ä¿å­˜ï¼Œ10ç§’å‘¨æœŸï¼‰
- resumeCheckpoint()      // æ¢å¤æ‰§è¡Œ
- getResumableCheckpoints() // è·å–å¯æ¢å¤ä»»åŠ¡åˆ—è¡¨
```

**å­˜å‚¨ä½ç½®**: `app.getPath('userData')/checkpoints/`

### RealtimeChannelï¼ˆå®æ—¶é€šä¿¡ï¼‰

WebSocket åŒå‘é€šä¿¡ï¼š

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| æ¶ˆæ¯ç¡®è®¤ | å¸¦è¶…æ—¶çš„ ACK æœºåˆ¶ |
| å¿ƒè·³ä¿æ´» | 30 ç§’å‘¨æœŸ |
| è‡ªåŠ¨é‡è¿ | æŒ‡æ•°é€€é¿ï¼Œæœ€å¤š 5 æ¬¡ |
| æ¶ˆæ¯ç¼“å†² | æ–­çº¿æœŸé—´ç¼“å­˜æ¶ˆæ¯ |

**æ¶ˆæ¯ç±»å‹**: task:start, task:progress, task:chunk, task:complete, task:error, task:cancel, sync:request, sync:response

### AgentSchedulerï¼ˆå¤š Agent è°ƒåº¦ï¼‰

7 ç§ Agent è§’è‰²ï¼š

| è§’è‰² | èŒè´£ |
|------|------|
| planner | ä»»åŠ¡åˆ†è§£å’Œè§„åˆ’ |
| researcher | ä¿¡æ¯æ£€ç´¢å’Œç ”ç©¶ |
| coder | ä»£ç ç”Ÿæˆ |
| reviewer | ä»£ç å®¡æŸ¥ |
| writer | æ–‡æ¡£ç¼–å†™ |
| tester | æµ‹è¯•æ‰§è¡Œ |
| coordinator | ä»»åŠ¡åè°ƒ |

4 ç§è°ƒåº¦ç­–ç•¥ï¼š
- `round_robin`: è½®è¯¢åˆ†é…
- `least_busy`: æœ€ç©ºé—²ä¼˜å…ˆ
- `skill_match`: æŠ€èƒ½åŒ¹é…
- `priority_first`: ä¼˜å…ˆçº§ä¼˜å…ˆ

### StrategyManagerï¼ˆç­–ç•¥æ¼”è¿›ï¼‰

æ”¯æŒ 5 ç§ç­–ç•¥ç±»å‹ï¼š
- routing: è·¯ç”±ç­–ç•¥
- execution: æ‰§è¡Œç­–ç•¥
- tool_selection: å·¥å…·é€‰æ‹©
- agent_selection: Agent é€‰æ‹©
- error_handling: é”™è¯¯å¤„ç†

**å­¦ä¹ æœºåˆ¶**ï¼š
1. æ”¶é›†ç”¨æˆ·åé¦ˆï¼ˆpositive/negative/neutralï¼‰
2. è‡ªåŠ¨è°ƒæ•´è§„åˆ™æƒé‡å’Œä¼˜å…ˆçº§
3. ç”Ÿæˆæ–°è§„åˆ™
4. è·¨ç”¨æˆ·èšåˆå­¦ä¹ ï¼ˆå¯é…ç½®éšç§ç­‰çº§ï¼‰
