# 系统架构概览

> 本文档提供 Code Agent 的高层架构视图

## 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Code Agent Architecture                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                         Presentation Layer (Electron)                   │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐  │ │
│  │  │  Chat View   │ │ Workspace    │ │  Generation  │ │   Settings   │  │ │
│  │  │  Component   │ │ Explorer     │ │  Selector    │ │   Panel      │  │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘  │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐  │ │
│  │  │ Tool Viewer  │ │  Todo List   │ │ Diff Viewer  │ │ Prompt Viewer│  │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘  │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                    │ IPC                                     │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                         Application Layer (Main Process)                │ │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │ │
│  │  │                        Agent Orchestrator                         │  │ │
│  │  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐    │  │ │
│  │  │  │ Generation │ │   Model    │ │   Tool     │ │  Session   │    │  │ │
│  │  │  │  Manager   │ │  Router    │ │  Registry  │ │  Manager   │    │  │ │
│  │  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘    │  │ │
│  │  └──────────────────────────────────────────────────────────────────┘  │ │
│  │  ┌──────────────────────────────────────────────────────────────────┐  │ │
│  │  │                        Core Services                              │  │ │
│  │  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐    │  │ │
│  │  │  │ Permission │ │   File     │ │  Process   │ │   Config   │    │  │ │
│  │  │  │  Service   │ │  Service   │ │  Service   │ │  Service   │    │  │ │
│  │  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘    │  │ │
│  │  └──────────────────────────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                         │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                         Tool Layer                                      │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │ │
│  │  │                    Tool Implementation                           │   │ │
│  │  │                                                                  │   │ │
│  │  │  Gen 1 Tools    Gen 2 Tools    Gen 3 Tools    Gen 4 Tools       │   │ │
│  │  │  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐         │   │ │
│  │  │  │  bash   │   │  glob   │   │  task   │   │  skill  │         │   │ │
│  │  │  │  read   │   │  grep   │   │ todoWrite│  │webFetch │         │   │ │
│  │  │  │  write  │   │ listDir │   │askUser  │   │webSearch│         │   │ │
│  │  │  │  edit   │   │  mcp    │   │planMode │   │ hooks   │         │   │ │
│  │  │  └─────────┘   └─────────┘   └─────────┘   └─────────┘         │   │ │
│  │  └─────────────────────────────────────────────────────────────────┘   │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                    │                                         │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                         External Layer                                  │ │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐          │ │
│  │  │  DeepSeek  │ │   Claude   │ │   OpenAI   │ │   Local    │          │ │
│  │  │    API     │ │    API     │ │    API     │ │   Model    │          │ │
│  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘          │ │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐                         │ │
│  │  │   File     │ │  Process   │ │  Network   │                         │ │
│  │  │  System    │ │ (Shell)    │ │  (HTTP)    │                         │ │
│  │  └────────────┘ └────────────┘ └────────────┘                         │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 技术栈

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| **桌面框架** | Electron 33+ | 跨平台，生态成熟 |
| **前端框架** | React 18 + TypeScript 5.6 | 组件化开发 |
| **状态管理** | Zustand 5 | 轻量级状态管理 |
| **UI 组件** | Tailwind CSS 3.4 | 快速开发 |
| **构建工具** | esbuild + Vite | 快速开发体验 |
| **IPC 通信** | Electron IPC + Type-safe | 主进程/渲染进程通信 |
| **本地存储** | SQLite (better-sqlite3) | 会话/配置持久化 |
| **云端存储** | Supabase + pgvector | 同步 + 向量存储 |
| **AI 模型** | DeepSeek API (主要) | 多模型支持 |

## 分层架构

| 层级 | 职责 | 详细文档 |
|------|------|----------|
| Presentation | UI 组件、状态管理、用户交互 | [frontend.md](./frontend.md) |
| Application | Agent 编排、会话管理、模型路由 | [agent-core.md](./agent-core.md) |
| Tool | 工具实现、代际演进 | [tool-system.md](./tool-system.md) |
| Data | 本地存储、云端同步 | [data-storage.md](./data-storage.md) |
| Cloud | 云端任务、多设备同步 | [cloud-architecture.md](./cloud-architecture.md) |

## 8 代工具演进

| 代际 | 核心能力 | 工具集 |
|------|----------|--------|
| Gen1 | 基础文件操作 | bash, read_file, write_file, edit_file |
| Gen2 | 代码搜索 | + glob, grep, list_directory, mcp |
| Gen3 | 任务规划 | + task, todo_write, ask_user_question, plan_mode |
| Gen4 | 网络能力 | + skill, web_fetch, web_search, hooks |
| Gen5 | 记忆系统 | + memory_store, memory_search, code_index |
| Gen6 | 视觉交互 | + screenshot, computer_use, browser_action |
| Gen7 | 多代理 | + spawn_agent, agent_message, workflow_orchestrate |
| Gen8 | 自我进化 | + strategy_optimize, tool_create, self_evaluate |

## 相关文档

- [Agent 核心](./agent-core.md) - AgentLoop、消息流、规划系统
- [工具系统](./tool-system.md) - 工具注册、执行、代际演进
- [前端架构](./frontend.md) - React 组件、状态管理
- [数据存储](./data-storage.md) - SQLite、Supabase、向量数据库
- [云端架构](./cloud-architecture.md) - 云端任务、多设备同步
- [架构决策记录](../decisions/) - ADR 文档
