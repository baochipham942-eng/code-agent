# Code Agent éƒ¨ç½²é…ç½®æŒ‡å—

> ä» CLAUDE.md æå–çš„éƒ¨ç½²ç›¸å…³æ–‡æ¡£

## éƒ¨ç½²æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Code Agent éƒ¨ç½²æ¶æ„                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚  â”‚   å®¢æˆ·ç«¯      â”‚ Electron æ¡Œé¢åº”ç”¨                             â”‚
â”‚  â”‚  (macOS)     â”‚ - æ‰“åŒ…: npm run dist:mac                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ - äº§ç‰©: release/*.dmg                         â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ HTTPS                                                 â”‚
â”‚         â–¼                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                    Vercel                             â”‚       â”‚
â”‚  â”‚  https://code-agent-beta.vercel.app                   â”‚       â”‚
â”‚  â”‚                                                       â”‚       â”‚
â”‚  â”‚  /api/update    - ç‰ˆæœ¬æ£€æŸ¥                            â”‚       â”‚
â”‚  â”‚  /api/auth      - GitHub OAuth                        â”‚       â”‚
â”‚  â”‚  /api/sync      - æ•°æ®åŒæ­¥                            â”‚       â”‚
â”‚  â”‚  /api/prompts   - System Prompt                       â”‚       â”‚
â”‚  â”‚  /api/model-proxy - AI æ¨¡å‹ä»£ç†                       â”‚       â”‚
â”‚  â”‚  /api/tools     - äº‘ç«¯å·¥å…· (æœç´¢/æŠ“å–/PPT)            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         â”‚                                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚         â”‚               â”‚               â”‚                       â”‚
â”‚         â–¼               â–¼               â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  Supabase  â”‚  â”‚ é˜¿é‡Œäº‘ FC  â”‚  â”‚  AI APIs   â”‚                 â”‚
â”‚  â”‚  PostgreSQLâ”‚  â”‚ DDG ä»£ç†   â”‚  â”‚ DeepSeek   â”‚                 â”‚
â”‚  â”‚  + pgvectorâ”‚  â”‚            â”‚  â”‚ æ™ºè°±/OpenAIâ”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Vercel é…ç½®

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| é¡¹ç›®å | `code-agent` |
| åŸŸå | `https://code-agent-beta.vercel.app` |
| Root Directory | `vercel-api` |

```bash
# éªŒè¯éƒ¨ç½²
curl -s "https://code-agent-beta.vercel.app/api/update?action=health"
```

### API ç«¯ç‚¹åˆ—è¡¨

> æ³¨æ„ï¼šç”±äº Vercel Hobby è®¡åˆ’ 12 å‡½æ•°é™åˆ¶ï¼Œè¿ç»´ç±» API å·²æ•´åˆ

| ç«¯ç‚¹ | è¯´æ˜ |
|------|------|
| /api/agent | äº‘ç«¯ Agent |
| /api/auth | GitHub OAuth è®¤è¯ |
| /api/model-proxy | æ¨¡å‹ä»£ç† |
| /api/prompts | System Prompt |
| /api/sync | æ•°æ®åŒæ­¥ |
| /api/system | è¿ç»´æ•´åˆï¼ˆhealth/init-db/migrateï¼‰|
| /api/tools | äº‘ç«¯å·¥å…·ï¼ˆapi/scrape/search/pptï¼‰|
| /api/update | ç‰ˆæœ¬æ›´æ–°æ£€æŸ¥ |
| /api/user-keys | ç”¨æˆ· API Key ç®¡ç† |
| /api/v1/config | äº‘ç«¯é…ç½®ä¸­å¿ƒ |

### system.ts ç”¨æ³•

```bash
# å¥åº·æ£€æŸ¥
curl "https://code-agent-beta.vercel.app/api/system?action=health"

# åˆå§‹åŒ–æ•°æ®åº“ï¼ˆéœ€è¦ X-Init-Key headerï¼‰
curl -X POST "https://code-agent-beta.vercel.app/api/system?action=init-db" \
  -H "X-Init-Key: $DB_INIT_KEY"

# æ•°æ®åº“è¿ç§»
curl -X POST "https://code-agent-beta.vercel.app/api/system?action=migrate" \
  -H "X-Init-Key: $DB_INIT_KEY"
```

---

## é˜¿é‡Œäº‘å‡½æ•°è®¡ç®— (FC)

ç”¨äº DuckDuckGo æœç´¢ä»£ç†ï¼Œç»•è¿‡å›½å†…ç½‘ç»œé™åˆ¶ã€‚

| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| æœåŠ¡å | `code-agent-proxy` |
| è¿è¡Œç¯å¢ƒ | Node.js 18 |
| å†…å­˜ | 128MB |
| è¶…æ—¶ | 30s |
| ä»£ç ä½ç½® | `vercel-api/docs/aliyun-fc-proxy.js` |

### éƒ¨ç½²æ­¥éª¤

1. ç™»å½•é˜¿é‡Œäº‘å‡½æ•°è®¡ç®—æ§åˆ¶å° https://fc.console.aliyun.com
2. åˆ›å»ºæœåŠ¡ `code-agent-proxy`
3. åˆ›å»ºå‡½æ•°ï¼Œç²˜è´´ `vercel-api/docs/aliyun-fc-proxy.js` ä»£ç 
4. é…ç½® HTTP è§¦å‘å™¨ï¼ˆå…¬ç½‘è®¿é—®ï¼‰
5. å¤åˆ¶è§¦å‘å™¨ URL åˆ° Vercel ç¯å¢ƒå˜é‡ `DUCKDUCKGO_PROXY_URL`

### éªŒè¯

```bash
curl -X POST "https://<your-fc-trigger-url>" \
  -H "Content-Type: application/json" \
  -d '{"query": "test search", "maxResults": 5}'
```

---

## äº‘ç«¯ Prompt ç®¡ç†

System Prompt é‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼š

**æ¶æ„**ï¼š
- äº‘ç«¯ `/api/prompts` ç«¯ç‚¹æä¾›å„ä»£é™…çš„ system prompt
- å®¢æˆ·ç«¯ `PromptService` å¯åŠ¨æ—¶å¼‚æ­¥æ‹‰å–ï¼Œ1 å°æ—¶ç¼“å­˜
- æ‹‰å–å¤±è´¥è‡ªåŠ¨é™çº§åˆ°å†…ç½® prompts

**ä¼˜åŠ¿**ï¼š
- ä¿®æ”¹ prompt åªéœ€éƒ¨ç½²äº‘ç«¯ï¼Œæ— éœ€é‡æ–°æ‰“åŒ…å®¢æˆ·ç«¯
- ç¦»çº¿ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œï¼ˆä½¿ç”¨å†…ç½®ç‰ˆæœ¬ï¼‰

**API ç«¯ç‚¹**ï¼š
```bash
# è·å–æ‰€æœ‰ä»£é™… prompts
curl "https://code-agent-beta.vercel.app/api/prompts?gen=all"

# è·å–ç‰¹å®šä»£é™…
curl "https://code-agent-beta.vercel.app/api/prompts?gen=gen4"

# åªè·å–ç‰ˆæœ¬å·
curl "https://code-agent-beta.vercel.app/api/prompts?version=true"
```

---

## æ™ºè°± vs DeepSeek æ¨¡å‹å¯¹æ¯”

æœ¬åº”ç”¨æ”¯æŒæ™ºè°±å’Œ DeepSeek ä¸¤ä¸ªåŸºç¡€æ¨¡å‹æä¾›å•†ã€‚å¦‚æœé…ç½®äº†æ™ºè°± API Keyï¼Œå°†ä¼˜å…ˆä½¿ç”¨æ™ºè°±ã€‚

### ä»·æ ¼å¯¹æ¯”ï¼ˆ2025-01 æ›´æ–°ï¼‰

| èƒ½åŠ› | æ™ºè°± GLM-4.7 | DeepSeek V3.2 | è¯´æ˜ |
|------|-------------|---------------|------|
| è¾“å…¥ä»·æ ¼ | Â¥2-4/M tokens | $0.28/M (~Â¥2/M) | æ™ºè°±æŒ‰ä¸Šä¸‹æ–‡é•¿åº¦åˆ†å±‚ |
| è¾“å‡ºä»·æ ¼ | Â¥8-16/M tokens | $0.42/M (~Â¥3/M) | DeepSeek æ›´ä¾¿å®œ |
| ç¼“å­˜å‘½ä¸­ | Â¥0.4-0.8/M | $0.028/M (~Â¥0.2/M) | ç¼“å­˜å DeepSeek ä¼˜åŠ¿æ˜æ˜¾ |
| å…è´¹æ¨¡å‹ | GLM-4.7-Flash âœ… | âŒ | æ™ºè°±æœ‰å…è´¹å¿«é€Ÿæ¨¡å‹ |
| ä¸Šä¸‹æ–‡ | 200K | 128K | æ™ºè°±æ”¯æŒæ›´é•¿ä¸Šä¸‹æ–‡ |

### åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | æ™ºè°± | DeepSeek | å¤‡æ³¨ |
|------|------|----------|------|
| Tool Calls | âœ… | âœ… | å‡æ”¯æŒ |
| JSON Mode | âœ… | âœ… | å‡æ”¯æŒ |
| Streaming | âœ… | âœ… | å‡æ”¯æŒ |
| è§†è§‰ç†è§£ | GLM-4.6V | âŒ | æ™ºè°±æ”¯æŒå¤šæ¨¡æ€ |
| å›¾ç‰‡ç”Ÿæˆ | CogView-4 (Â¥0.06/å¼ ) | âŒ | æ™ºè°±ç‹¬æœ‰ |
| è§†é¢‘ç”Ÿæˆ | CogVideoX-3 (Â¥1/ä¸ª) | âŒ | æ™ºè°±ç‹¬æœ‰ |
| æ€ç»´é“¾æ¨ç† | GLM-Z1 ç³»åˆ— | deepseek-reasoner | å‡æ”¯æŒ |

### æ¨èé…ç½®

| åœºæ™¯ | æ¨è | åŸå›  |
|------|------|------|
| ç¼–ç¨‹åŠ©æ‰‹ï¼ˆé«˜é¢‘ä½¿ç”¨ï¼‰ | æ™ºè°± Coding Max | å›ºå®šæˆæœ¬ï¼Œé«˜é€Ÿç‡ |
| å¤šæ¨¡æ€ï¼ˆå›¾ç‰‡/è§†é¢‘ï¼‰ | æ™ºè°± | ç‹¬æœ‰èƒ½åŠ› |
| é•¿ä¸Šä¸‹æ–‡å¤„ç† | æ™ºè°± GLM-4.7 | 200K ä¸Šä¸‹æ–‡ |
| æˆæœ¬æ•æ„Ÿï¼ˆæŒ‰é‡ä»˜è´¹ï¼‰ | DeepSeek | è¾“å‡ºä»·æ ¼ä¾¿å®œ 50%+ |
| æ¨ç†èƒ½åŠ› | DeepSeek Reasoner | æ€ç»´é“¾æ›´å¼º |

---

## å·²é…ç½®çš„æ¨¡å‹çŸ©é˜µ

> æ›´æ–°æ—¶é—´: 2026-02

### ä¾›åº”å•†æ€»è§ˆ

| ä¾›åº”å•† | API Key | æˆæœ¬ç±»å‹ | ä¸»è¦ç”¨é€” |
|--------|---------|----------|----------|
| **DeepSeek** | âœ… å·²é…ç½® | æŒ‰é‡ | ä¸»åŠ›ä»£ç æ¨¡å‹ |
| **æ™ºè°± GLM** | âœ… å·²é…ç½® | åŒ…å¹´/å…è´¹ | è§†è§‰ + å…è´¹å¿«é€Ÿæ¨¡å‹ |
| **Groq** | âœ… å·²é…ç½® | å…è´¹é¢åº¦ | æé€Ÿæ¨ç† |
| **ç™¾ç‚¼/åƒé—®** | âœ… å·²é…ç½® | æŒ‰é‡ | å…¨æ¨¡æ€ (è§†é¢‘/éŸ³é¢‘/å›¾åƒ) |
| **Kimi K2.5** | âœ… å·²é…ç½® | åŒ…æœˆ | é•¿ä¸Šä¸‹æ–‡ä»£ç  (haioi.net) |
| **Perplexity** | âœ… å·²é…ç½® | æŒ‰é‡ | è”ç½‘æœç´¢ |
| **OpenRouter** | âœ… å·²é…ç½® | æŒ‰é‡/å…è´¹ | ä¸­è½¬å„å®¶æ¨¡å‹ |

### OpenRouter æ¨¡å‹æ˜ç»†

| æ¨¡å‹ | æˆæœ¬ | è¯´æ˜ |
|------|------|------|
| `google/gemma-3n-e2b-it:free` | ğŸ†“ å…è´¹ | Gemma 3 |
| `meta-llama/llama-3.3-70b-instruct:free` | ğŸ†“ å…è´¹ | Llama 3.3 70B |
| `deepseek/deepseek-r1-0528:free` | ğŸ†“ å…è´¹ | DeepSeek R1 æ¨ç† |
| `google/gemini-3-flash-preview` | ğŸ’° æŒ‰é‡ | Gemini 3 Flash |
| `google/gemini-3-pro-preview` | ğŸ’° æŒ‰é‡ | Gemini 3 Pro |
| `anthropic/claude-opus-4.5` | ğŸ’° æŒ‰é‡ | Claude Opus 4.5 |
| `anthropic/claude-sonnet-4.5` | ğŸ’° æŒ‰é‡ | Claude Sonnet 4.5 |
| `anthropic/claude-haiku-4.5` | ğŸ’° æŒ‰é‡ | Claude Haiku 4.5 |
| `openai/gpt-5.2` | ğŸ’° æŒ‰é‡ | GPT-5.2 |
| `openai/gpt-5.2-codex` | ğŸ’° æŒ‰é‡ | GPT-5.2 Codex |
| `meta-llama/llama-4-maverick` | ğŸ’° æŒ‰é‡ | Llama 4 Maverick |
| `deepseek/deepseek-v3.2` | ğŸ’° æŒ‰é‡ | DeepSeek V3.2 |

### ç™¾ç‚¼/åƒé—® æ¨¡å‹æ˜ç»†

| æ¨¡å‹ | æˆæœ¬ | è¯´æ˜ |
|------|------|------|
| `qwen3-max` | ğŸ’° æŒ‰é‡ | æ——èˆ°è¯­è¨€æ¨¡å‹ |
| `qwen-max` / `qwen-plus` / `qwen-turbo` | ğŸ’° æŒ‰é‡ | è¯­è¨€æ¨¡å‹ç³»åˆ— |
| `qwq-plus` | ğŸ’° æŒ‰é‡ | æ·±åº¦æ¨ç† |
| `qvq-max` | ğŸ’° æŒ‰é‡ | è§†è§‰æ¨ç† |
| `qwen3-coder-plus` / `qwen3-coder-flash` | ğŸ’° æŒ‰é‡ | ä»£ç æ¨¡å‹ |
| `qwen-vl-max` / `qwen3-vl-plus` / `qwen3-vl-flash` | ğŸ’° æŒ‰é‡ | è§†è§‰æ¨¡å‹ |
| `qwen-omni-turbo` / `qwen3-omni-flash` | ğŸ’° æŒ‰é‡ | å…¨æ¨¡æ€ (å›¾+éŸ³+è§†é¢‘) |
| `qwen-image-max` / `qwen-image-edit-max` | ğŸ’° æŒ‰é‡ | å›¾åƒç”Ÿæˆ/ç¼–è¾‘ |
| `qwen3-tts-flash` / `qwen3-asr-flash-realtime` | ğŸ’° æŒ‰é‡ | è¯­éŸ³åˆæˆ/è¯†åˆ« |
| `qwen2.5-7b-instruct-1m` | ğŸ’° æŒ‰é‡ | è¶…é•¿ä¸Šä¸‹æ–‡ (1M) |

### æ™ºè°± GLM æ¨¡å‹æ˜ç»†

| æ¨¡å‹ | æˆæœ¬ | è¯´æ˜ |
|------|------|------|
| `glm-4.7` | ğŸ“… åŒ…å¹´ | æ——èˆ°è¯­è¨€ (Codingå¥—é¤) |
| `glm-4.6v` | ğŸ“… åŒ…å¹´ | æ——èˆ°è§†è§‰ (Codingå¥—é¤) |
| `glm-4.7-flash` | ğŸ†“ å…è´¹ | å¿«é€Ÿè¯­è¨€ |
| `glm-4.6v-flash` | ğŸ†“ å…è´¹ | å¿«é€Ÿè§†è§‰ |
| `codegeex-4` | ğŸ†“ å…è´¹ | ä»£ç ä¸“ç”¨ |
| `cogview-3-flash` | ğŸ†“ å…è´¹ | æ–‡ç”Ÿå›¾ |
| `cogvideox-flash` | ğŸ†“ å…è´¹ | æ–‡ç”Ÿè§†é¢‘ |

### Groq æ¨¡å‹æ˜ç»†

| æ¨¡å‹ | æˆæœ¬ | è¯´æ˜ |
|------|------|------|
| `llama-4-maverick-17b-128e-instruct` | ğŸ« é¢åº¦ | Llama 4 æœ€æ–° |
| `llama-4-scout-17b-16e-instruct` | ğŸ« é¢åº¦ | Llama 4 å¤šæ¨¡æ€ |
| `llama-3.3-70b-versatile` | ğŸ« é¢åº¦ | Llama 3.3 ç¨³å®šç‰ˆ |
| `moonshotai/kimi-k2-instruct` | ğŸ« é¢åº¦ | Kimi K2 æé€Ÿç‰ˆ |
| `groq/compound` | ğŸ« é¢åº¦ | æ™ºèƒ½è·¯ç”± |

### å½“å‰è·¯ç”±é…ç½®

```json
{
  "routing": {
    "code": {"provider": "moonshot", "model": "kimi-k2.5"},
    "vision": {"provider": "zhipu", "model": "glm-4.6v"},
    "fast": {"provider": "zhipu", "model": "glm-4.7-flash"},
    "gui": {"provider": "zhipu", "model": "glm-4.6v-flash"},
    "video": {"provider": "qwen", "model": "qwen3-vl-plus"}
  }
}
```

---

## .env æ–‡ä»¶ä½ç½®

| åœºæ™¯ | è·¯å¾„ |
|------|------|
| å¼€å‘æ¨¡å¼ | `/Users/linchen/Downloads/ai/code-agent/.env` |
| æ‰“åŒ…åº”ç”¨ | `/Applications/Code Agent.app/Contents/Resources/.env` |

**æ³¨æ„**ï¼šä¿®æ”¹ `.env` åï¼Œæ‰“åŒ…åº”ç”¨éœ€è¦æ‰‹åŠ¨åŒæ­¥ï¼š
```bash
cp /Users/linchen/Downloads/ai/code-agent/.env "/Applications/Code Agent.app/Contents/Resources/.env"
```
