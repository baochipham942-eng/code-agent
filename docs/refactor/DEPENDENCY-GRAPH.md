# 任务依赖关系图

## 可视化依赖图

```
                         ┌─────────────────────────────────────┐
                         │            开始                      │
                         └─────────────────┬───────────────────┘
                                           │
                 ┌─────────────────────────┴─────────────────────────┐
                 │                                                    │
                 ▼                                                    ▼
    ┌────────────────────────┐                        ┌────────────────────────┐
    │      TASK-01           │                        │      TASK-02           │
    │   ═══════════════      │                        │   ═══════════════      │
    │   安全加固              │                        │   热更新系统           │
    │   Agent-Security       │  ◄─── 可并行 ───►      │   Agent-Cloud          │
    │   1 周                 │                        │   2 周                 │
    │   依赖: 无             │                        │   依赖: 无             │
    └───────────┬────────────┘                        └───────────┬────────────┘
                │                                                  │
                │              ┌───────────────────────────────────┘
                │              │
                ▼              ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                              TASK-03                                     │
    │                         ═══════════════                                  │
    │                          主进程重构                                       │
    │                        Agent-Refactor                                    │
    │                            2 周                                          │
    │                  依赖: TASK-01 ✓, TASK-02 ✓                              │
    └─────────────────────────────┬───────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                              TASK-04                                     │
    │                         ═══════════════                                  │
    │                          接口规范化                                       │
    │                        Agent-Refactor                                    │
    │                            1 周                                          │
    │                        依赖: TASK-03 ✓                                   │
    └─────────────────────────────┬───────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                              TASK-05                                     │
    │                         ═══════════════                                  │
    │                         编码规范统一                                      │
    │                        Agent-Quality                                     │
    │                            1 周                                          │
    │                        依赖: TASK-04 ✓                                   │
    └─────────────────────────────┬───────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                              TASK-06                                     │
    │                         ═══════════════                                  │
    │                          扩展性增强                                       │
    │                       Agent-Extension                                    │
    │                            2 周                                          │
    │                        依赖: TASK-05 ✓                                   │
    └─────────────────────────────┬───────────────────────────────────────────┘
                                  │
                                  ▼
    ┌─────────────────────────────────────────────────────────────────────────┐
    │                              TASK-07                                     │
    │                         ═══════════════                                  │
    │                          文档和测试                                       │
    │                         Agent-Docs                                       │
    │                            1 周                                          │
    │                        依赖: TASK-06 ✓                                   │
    └─────────────────────────────┬───────────────────────────────────────────┘
                                  │
                                  ▼
                         ┌─────────────────────────────────────┐
                         │            完成                      │
                         └─────────────────────────────────────┘
```

---

## 并行任务表

| 任务组 | 可并行任务 | 原因 | 文件冲突风险 |
|-------|-----------|------|-------------|
| **第一批** | TASK-01 + TASK-02 | 无依赖，修改文件不重叠 | ❌ 无冲突 |

### 第一批并行详情

| 维度 | TASK-01 (Agent-Security) | TASK-02 (Agent-Cloud) |
|-----|-------------------------|----------------------|
| **修改文件** | `package.json`, `SecureStorage.ts`, `gen8/toolCreate.ts` | `vercel-api/`, `services/cloud/`, `ToolRegistry.ts` |
| **新增文件** | `evolution/sandbox.ts` | `CloudConfigService.ts`, `FeatureFlagService.ts` |
| **涉及目录** | `src/main/services/`, `src/main/tools/gen8/` | `vercel-api/`, `src/main/services/cloud/` |
| **交叉点** | 无 | 无 |

---

## 串行任务表

| 任务 | 依赖任务 | 为什么必须串行 |
|-----|---------|---------------|
| TASK-03 | TASK-01 + TASK-02 | 需要 CloudConfigService 存在；安全修复需先完成 |
| TASK-04 | TASK-03 | 需要目录结构重组完成后再规范接口 |
| TASK-05 | TASK-04 | 需要目录和接口稳定后再统一命名 |
| TASK-06 | TASK-05 | 需要命名规范统一后再加装饰器 |
| TASK-07 | TASK-06 | 需要所有代码稳定后写文档和测试 |

---

## 时间线甘特图

```
Week 1  ████████████████████████████████████████████████████████████████████
        │  TASK-01 (Security)  │
        │████████████████████████████████████████████████████████████████████
        │  TASK-02 (Cloud)     │

Week 2  ████████████████████████████████████████████████████████████████████
        │  TASK-02 (Cloud) 继续│

Week 3  ████████████████████████████████████████████████████████████████████
        │  TASK-03 (Refactor)  │

Week 4  ████████████████████████████████████████████████████████████████████
        │  TASK-03 (Refactor)  │

Week 5  ████████████████████████████████████████████████████████████████████
        │  TASK-04 (Interface) │

Week 6  ████████████████████████████████████████████████████████████████████
        │  TASK-05 (Quality)   │

Week 7  ████████████████████████████████████████████████████████████████████
        │  TASK-06 (Extension) │

Week 8  ████████████████████████████████████████████████████████████████████
        │  TASK-06 (Extension) │

Week 9  ████████████████████████████████████████████████████████████████████
        │  TASK-07 (Docs)      │
```

---

## 文件锁定规则

### 锁定期间

| 阶段 | 锁定文件/目录 | 锁定 Agent | 其他 Agent 可做 |
|-----|-------------|-----------|----------------|
| Week 1-2 | `package.json`, `SecureStorage.ts` | Security | 不改这些文件 |
| Week 1-2 | `vercel-api/`, `services/cloud/` | Cloud | 不改这些文件 |
| Week 3-5 | `src/main/` 全目录 | Refactor | 不改主进程代码 |
| Week 6 | 全局文件（重命名期间）| Quality | 不新增文件 |
| Week 7-8 | `tools/decorators/`, `plugin/` | Extension | 不改扩展相关 |

### 冲突预防检查清单

启动新任务前确认：

- [ ] 前置任务已合并到 main
- [ ] 拉取最新 main 分支
- [ ] 确认没有未解决的合并冲突
- [ ] 确认 `npm run typecheck` 通过

---

## 交接检查清单

每个任务完成时必须：

1. [ ] 所有改动已 commit 并 push
2. [ ] PR 已创建并通过 CI
3. [ ] PR 已合并到 main
4. [ ] 任务文档底部填写「交接备注」
5. [ ] 通知下一个 Agent 可以开始

---

## Agent 启动顺序

```
Day 1:   启动 Agent-Security + Agent-Cloud (并行)
         ↓
Week 2:  Agent-Security 完成，等待 Agent-Cloud
         ↓
Week 3:  Agent-Cloud 完成，启动 Agent-Refactor
         ↓
Week 5:  Agent-Refactor 完成 TASK-03，继续 TASK-04
         ↓
Week 6:  Agent-Refactor 完成，启动 Agent-Quality
         ↓
Week 7:  Agent-Quality 完成，启动 Agent-Extension
         ↓
Week 9:  Agent-Extension 完成，启动 Agent-Docs
         ↓
Week 10: 全部完成
```
