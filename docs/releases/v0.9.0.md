# Code Agent v0.9.0 Release Notes

**Release Date:** TBD (pending completion of all sessions)

This release aligns Code Agent with Claude Code architecture, introducing significant improvements to security, tool handling, and extensibility.

---

## Highlights

### ðŸ”’ Security Module

Runtime security monitoring with comprehensive audit logging.

- **Command Monitoring**: Pre-execution validation for shell commands with configurable blocked/warning patterns
- **Sensitive Information Detection**: Automatic detection of 20+ sensitive patterns (API keys, AWS credentials, GitHub tokens, private keys)
- **Audit Logging**: JSONL audit logs for all tool executions at `~/.code-agent/audit/`
- **Log Masking**: Automatic redaction of sensitive information in logs

### ðŸ”§ Tool Enhancements

Improved reliability and safety for file operations.

- **Read-Before-Edit**: Files must be read before editing, preventing accidental overwrites
- **Smart Quote Normalization**: Curly/smart quotes automatically normalized for reliable string matching
- **External Modification Detection**: Warning when files are modified outside Code Agent
- **Enhanced Grep**: New `-A`, `-B`, `-C` context parameters and `--type` file filtering

### ðŸª Hooks System

User-configurable event hooks for custom automation.

- **11 Event Types**: PreToolUse, PostToolUse, SessionStart, SessionEnd, and more
- **Shell Script Execution**: Run external scripts with environment variables
- **Multi-Source Configuration**: Merge global and project-level hooks
- **Prompt-Based Hooks**: AI-powered evaluation for complex decisions

### ðŸ“ Prompt Improvements

Enhanced system prompts aligned with Claude Code.

- **Constitution Architecture**: Layered prompt design (soul, values, ethics, safety, judgment)
- **Injection Defense**: Multi-layer protection against prompt injection attacks
- **Detailed Tool Descriptions**: Comprehensive usage examples and anti-patterns

---

## New Features

### Security

| Feature | Description |
|---------|-------------|
| Command Monitor | Validates commands before execution |
| Sensitive Detector | Detects API keys, credentials, tokens |
| Audit Logger | Records all tool executions to JSONL |
| Log Masker | Automatically redacts sensitive data |

### Tool Enhancements

| Feature | Description |
|---------|-------------|
| File Read Tracker | Enforces read-before-edit pattern |
| Quote Normalizer | Normalizes smart quotes for matching |
| External Modification Detector | Warns on external file changes |
| Background Task Persistence | Recovers tasks after restart |

### Hooks

| Event | Trigger |
|-------|---------|
| PreToolUse | Before tool execution |
| PostToolUse | After successful execution |
| PostToolUseFailure | After failed execution |
| UserPromptSubmit | When user submits prompt |
| SessionStart | Session begins |
| SessionEnd | Session ends |
| Stop | Agent stops |
| SubagentStop | Subagent stops |
| PreCompact | Before context compaction |
| Setup | During initialization |
| Notification | For notifications |

---

## Breaking Changes

### Configuration

The `.claude/settings.json` file has new sections:

```json
{
  "security": { ... },
  "hooks": { ... }
}
```

See [Migration Guide](../migration/v0.9-upgrade.md) for details.

### Edit File Behavior

- Files must now be read before editing
- Edit operations will fail with "File must be read before editing" if not read first

### Quote Handling

- Smart/curly quotes are now normalized automatically
- This may affect edit operations that relied on exact quote matching

---

## Improvements

- Improved error messages for file operations
- Better logging with automatic sensitive data masking
- More reliable string matching in edit operations
- Enhanced grep with context lines support

---

## Bug Fixes

- TBD (will be populated during final release)

---

## Known Issues

- Audit log rotation not yet implemented (manual cleanup required)
- Hooks do not yet support async/parallel execution
- Context compression (B7-B11) is still in development

---

## Dependencies

This release requires:

- Node.js >= 18.0
- Electron 33.x
- macOS 11+ / Windows 10+ / Linux (Ubuntu 20.04+)

---

## Upgrade Instructions

1. **Backup your data**:
   ```bash
   cp -r ~/.code-agent ~/.code-agent.backup
   ```

2. **Download the new version** from releases

3. **Review configuration changes** in [Migration Guide](../migration/v0.9-upgrade.md)

4. **Start the application** - new configuration sections will be added automatically

---

## Contributors

- Session A: Security Module (A1-A15)
- Session B: Tool Enhancements + Context Management (B1-B16)
- Session C: Prompt Enhancements + Hooks System (C1-C18)
- Session D: Testing + Documentation + Release (D1-D15)

---

## Links

- [API Reference](../api-reference/index.md)
- [Migration Guide](../migration/v0.9-upgrade.md)
- [CHANGELOG](../../CHANGELOG.md)
