// ============================================================================
// Task Management Rules - 任务动态管理指导
// Claude Code 2.x compatible Task API guidance
// ============================================================================

export const TASK_MANAGEMENT_RULES = `
## 任务动态管理

使用 task_create/task_update/task_list/task_get 工具进行任务管理。

### 何时使用任务管理

**需要使用：**
- 复杂任务（3+ 步骤）
- 多阶段工作
- 需要跟踪进度的任务
- 用户提供任务列表时

**可以跳过：**
- 简单的单步操作
- 快速问答
- 纯信息查询

### 任务生命周期

\`\`\`
task_create → task_update(in_progress) → task_update(completed)
                                      → task_update(deleted)  # 不再需要时
\`\`\`

### 用户意图识别（重要）

用户不一定会直白地说"再加一个XXX功能"，需要从上下文和语义分析识别任务变化：

**新增任务的信号：**
- 直接请求："另外还需要..."、"顺便..."、"再加一个..."
- 隐含请求："对了，XX功能..."、"还有一个问题..."
- 条件触发："如果XXX的话，还要..."
- 扩展需求："能不能也支持..."、"最好也能..."
- 澄清后扩展：回答问题后发现的新需求

**修改任务的信号：**
- 范围变化："不用做XX了"、"只需要做YY"
- 优先级变化："先做这个"、"这个更重要"
- 需求澄清："我的意思是..."、"更准确地说..."

**取消/删除任务的信号：**
- 明确取消："不用做了"、"跳过这个"
- 方案变更："换个方式"、"改成用..."
- 已不需要："这个已经有了"、"别人已经做了"

### 响应用户补充

当识别到用户的意图变化时：

\`\`\`typescript
// 1. 先确认理解
"我理解您希望增加/修改/取消XXX任务"

// 2. 更新任务列表
task_create({ subject: "新任务", description: "..." })
// 或
task_update({ taskId: "X", status: "deleted" })

// 3. 继续执行
"现在开始处理..."
\`\`\`

### 任务状态管理

| 操作 | 使用场景 |
|------|----------|
| task_create | 创建新任务 |
| task_update(in_progress) | 开始执行任务前 |
| task_update(completed) | 任务完成后 |
| task_update(deleted) | 任务不再需要 |

### 依赖关系

使用 addBlockedBy/addBlocks 管理任务依赖：

\`\`\`typescript
// 任务 B 依赖任务 A
task_update({
  taskId: "B",
  addBlockedBy: ["A"]
})
\`\`\`

### 最佳实践

1. **即时响应**：识别到意图变化后立即更新任务列表
2. **保持同步**：任务列表应反映当前实际工作状态
3. **主动清理**：不再需要的任务应该删除，而非保留
4. **透明沟通**：更新任务后简要告知用户
`;
